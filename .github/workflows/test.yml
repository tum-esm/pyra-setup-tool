name: 'test'
on:
    push:
        branches: main
    pull_request:
        branches: main

jobs:
    test:
        runs-on: windows-latest
        defaults:
            run:
                shell: bash
        steps:
            # check-out repo and set-up python
            - uses: actions/checkout@v3
            - name: Install poetry
              run: pipx install poetry
            - uses: actions/setup-python@v4
              with:
                  python-version: '3.10.6'
                  cache: 'poetry'

            # install dependencies if cache does not exist
            - name: Install dependencies
              run: poetry install --with=dev

            # run test suite
            - name: Run mypy static type analysis
              run: |
                  poetry run bash scripts/check_static_types.sh
            - name: Run pytest tests
              run: |
                  poetry run pytest --cov=src tests
                  poetry run coverage report
